<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cats Universe ‚Äì Infinite Gallery</title>

<!-- Security Headers (for static hosting like GitHub Pages) -->
<meta http-equiv="Content-Security-Policy" content="
default-src 'self';
img-src https://raw.githubusercontent.com data:;
media-src https://raw.githubusercontent.com;
script-src 'self';
style-src 'self' 'unsafe-inline';
connect-src https://api.github.com;
">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta name="referrer" content="no-referrer">

<style>
:root{
  --bg:#050505;
  --card:#111;
  --accent:#ff79c6;
  --text:#eee;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  color:var(--text);
  text-align:center;
}

h1{
  color:var(--accent);
  margin:1.5em 0;
  font-weight:600;
}

#status{
  color:#888;
  margin-bottom:2em;
  white-space:pre-wrap;
}

.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:16px;
  max-width:1800px;
  margin:auto;
  padding:0 20px 40px;
}

.card{
  background:var(--card);
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 5px 15px rgba(0,0,0,0.6);
  transition:0.3s ease;
  opacity:0;
  transform:translateY(30px);
}

.card.visible{
  opacity:1;
  transform:translateY(0);
}

.card:hover{
  transform:scale(1.03);
}

img, video{
  width:100%;
  display:block;
  border-radius:14px;
}

video{
  background:black;
}

.skeleton{
  height:250px;
  background:linear-gradient(90deg,#111 25%,#1c1c1c 50%,#111 75%);
  background-size:200% 100%;
  animation:shine 1.5s infinite linear;
}

@keyframes shine{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}

button{
  margin:40px auto;
  padding:14px 50px;
  border:none;
  border-radius:40px;
  font-size:1.1em;
  background:var(--accent);
  cursor:pointer;
  font-weight:bold;
}

button:disabled{
  opacity:0.4;
  cursor:not-allowed;
}
</style>
</head>

<body>

<h1>üê± Cats Universe ‚Äì Photos & Videos Forever üêæ</h1>
<div id="status">Loading content from GitHub...</div>

<div class="gallery" id="gallery"></div>
<button id="loadMore" disabled>Loading...</button>

<script>
const CONFIG = {
  owner: "tooter9",
  repo: "Youvideo",
  branch: "main",
  basePaths: ["cats/"],
  imageExt: /\.(jpe?g|png|gif|webp)$/i,
  videoExt: /\.(mp4|webm|mov)$/i,
  token: ""
};

const BATCH = 40;
let files = [];
let shown = 0;

const gallery = document.getElementById("gallery");
const status = document.getElementById("status");
const btn = document.getElementById("loadMore");

function safeText(str){
  return str.replace(/[<>]/g,"");
}

async function fetchFiles(){
  const headers = CONFIG.token ? {Authorization:`token ${CONFIG.token}`} : {};

  try{
    const ref = await fetch(
      `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`,
      {headers}
    ).then(r=>r.json());

    if(ref.message) throw new Error(ref.message);

    const tree = await fetch(
      `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${ref.object.sha}?recursive=1`,
      {headers}
    ).then(r=>r.json());

    if(tree.message) throw new Error(tree.message);

    files = tree.tree.filter(item=>{
      if(item.type !== "blob") return false;
      const matchBase = CONFIG.basePaths.some(bp => item.path.startsWith(bp));
      return matchBase && (CONFIG.imageExt.test(item.path) || CONFIG.videoExt.test(item.path));
    }).map(f=>f.path).sort();

    localStorage.setItem("cats_cache",JSON.stringify(files));
    localStorage.setItem("cats_cache_time",Date.now());

    status.textContent = `Found ${files.length} media files`;
  }catch(e){
    status.textContent = "API error. Using cache if available.";
    files = JSON.parse(localStorage.getItem("cats_cache")||"[]");
  }
}

function createCard(path){
  const card = document.createElement("div");
  card.className = "card";

  const skeleton = document.createElement("div");
  skeleton.className = "skeleton";
  card.appendChild(skeleton);

  const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;

  let media;

  if(CONFIG.imageExt.test(path)){
    media = new Image();
    media.loading = "lazy";
  } else if(CONFIG.videoExt.test(path)){
    media = document.createElement("video");
    media.controls = true;
    media.preload = "metadata";
  }

  media.src = url;
  media.alt = safeText(path.split("/").pop());

  media.onload = media.onloadeddata = ()=>{
    skeleton.remove();
    card.classList.add("visible");
  };

  media.onerror = ()=>card.remove();

  card.appendChild(media);
  gallery.appendChild(card);
}

function renderBatch(){
  const end = Math.min(shown + BATCH, files.length);

  for(let i=shown;i<end;i++){
    createCard(files[i]);
  }

  shown = end;
  status.textContent = `Showing ${shown} / ${files.length}`;
  btn.disabled = shown >= files.length;
  btn.textContent = btn.disabled ? "All loaded üê±" : "Load more";
}

const observer = new IntersectionObserver(entries=>{
  if(entries[0].isIntersecting && shown < files.length){
    renderBatch();
  }
});
observer.observe(btn);

(async()=>{
  const cache = localStorage.getItem("cats_cache");
  if(cache){
    files = JSON.parse(cache);
    status.textContent = `Loaded ${files.length} from cache`;
  }else{
    await fetchFiles();
  }

  if(files.length){
    btn.disabled=false;
    renderBatch();
  }else{
    status.textContent += "\nUpload media to /cats/ folder.";
  }
})();

btn.onclick = renderBatch;
</script>

</body>
</html>
