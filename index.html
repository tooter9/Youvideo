<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cats Gallery</title>
  <style>
    :root {
      --bg: #0e0b16;
      --text: #e5e5e5;
      --accent: #ff2ced;
      --card: #1a122b;
      --hover: #2d1b47;
      --grid-glow: rgba(255, 45, 237, 0.08);
    }
    body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      font-family: 'Minecraft', 'Courier New', monospace;
      text-align: center;
      min-height: 100vh;
      background-image:
        linear-gradient(rgba(255, 45, 237, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 45, 237, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
    }
    h1 {
      color: var(--accent);
      margin: 1em 0;
      font-size: 2em;
      text-shadow: 0 0 6px var(--accent);
      letter-spacing: 2px;
      font-weight: bold;
    }
    #status {
      color: #a0a0a0;
      margin: 1.5em auto;
      font-size: 1em;
      max-width: 600px;
      line-height: 1.5;
      background: rgba(26, 18, 43, 0.6);
      padding: 12px;
      border: 1px solid rgba(255, 45, 237, 0.2);
      border-radius: 4px;
      display: inline-block;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 10px;
    }
    .item {
      background: var(--card);
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      transition: all 0.2s;
      opacity: 0;
      transform: translateY(10px);
      aspect-ratio: 1;
      border: 1px solid rgba(255, 45, 237, 0.1);
    }
    .item.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .item:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 12px rgba(255, 45, 237, 0.2);
      border-color: rgba(255, 45, 237, 0.3);
    }
    .item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    #loadMore {
      margin: 3em auto;
      padding: 12px 32px;
      font-size: 1em;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(255, 45, 237, 0.3);
      font-family: 'Minecraft', 'Courier New', monospace;
      letter-spacing: 1px;
    }
    #loadMore:hover {
      background: #ff00cc;
      box-shadow: 0 4px 12px rgba(255, 45, 237, 0.4);
    }
    #loadMore:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    @media (max-width: 900px) {
      .gallery {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 500px) {
      .gallery {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>CATS GALLERY</h1>
  <div id="status">LOADING CATS...</div>

  <div class="gallery" id="gallery"></div>
  <button id="loadMore" disabled>LOADING</button>

  <script>
    const CONFIG = {
      owner: 'tooter9',
      repo: 'Youvideo',
      branch: 'main',
      basePaths: ['cats/'],
      extensions: /\.(jpe?g|png|gif|webp)$/i,
      token: ''
    };

    let allFiles = [];
    let displayed = 0;
    const BATCH = 16;

    const gallery = document.getElementById('gallery');
    const status = document.getElementById('status');
    const btn = document.getElementById('loadMore');

    function getCache() {
      try {
        const c = localStorage.getItem('catsCache');
        const t = localStorage.getItem('catsCacheTime');
        if (c && Date.now() - t < 7*24*60*60*1000) return JSON.parse(c);
      } catch {}
      return null;
    }

    async function fetchList() {
      status.textContent = 'FETCHING FILES FROM GITHUB...';
      const headers = CONFIG.token ? { Authorization: `token ${CONFIG.token}` } : {};
      try {
        const ref = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`, {headers}).then(r=>r.json());
        if (ref.message) throw new Error(ref.message);
        const sha = ref.object.sha;

        const tree = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${sha}?recursive=1`, {headers}).then(r=>r.json());
        if (tree.message) throw new Error(tree.message);

        if (tree.truncated) {
          status.textContent = 'WARNING: TOO MANY FILES. SPLIT INTO SUBFOLDERS.';
        }

        allFiles = [];
        tree.tree.forEach(item => {
          if (item.type === 'blob' && CONFIG.extensions.test(item.path)) {
            for (const bp of CONFIG.basePaths) {
              if (item.path.startsWith(bp)) {
                allFiles.push(item.path);
                break;
              }
            }
          }
        });

        allFiles.sort(() => Math.random() - 0.5);
        localStorage.setItem('catsCache', JSON.stringify(allFiles));
        localStorage.setItem('catsCacheTime', Date.now());
        status.textContent = 'READY.';
      } catch (e) {
        status.textContent = `ERROR: ${e.message}`;
        allFiles = getCache() || [];
      }
    }

    function renderNextBatch() {
      const end = Math.min(displayed + BATCH, allFiles.length);
      for (let i = displayed; i < end; i++) {
        const path = allFiles[i];
        const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;

        const div = document.createElement('div');
        div.className = 'item';

        const img = new Image();
        img.src = url;
        img.alt = 'Cat';
        img.loading = 'lazy';
        img.onerror = () => div.remove();

        div.appendChild(img);
        gallery.appendChild(div);

        setTimeout(() => div.classList.add('visible'), 20 * (i - displayed));
      }
      displayed = end;

      btn.disabled = displayed >= allFiles.length;
      btn.textContent = btn.disabled ? 'NO MORE CATS' : 'LOAD MORE';
    }

    const obs = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting && displayed < allFiles.length) renderNextBatch();
    }, {threshold: 0.5});
    obs.observe(btn);

    (async () => {
      allFiles = getCache();
      if (!allFiles?.length) await fetchList();
      else status.textContent = 'CACHE LOADED.';

      if (allFiles.length > 0) {
        renderNextBatch();
        btn.disabled = false;
        btn.textContent = 'LOAD MORE';
      } else {
        status.textContent = 'NO CATS FOUND.';
      }
    })();

    btn.onclick = renderNextBatch;
  </script>
</body>
</html>
