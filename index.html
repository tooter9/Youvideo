<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CAT OH MY GOD</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    :root {
      --bg: #0b0814;
      --accent-pink: #ff00ff;
      --accent-lime: #39ff14;
      --accent-cyan: #00ffff;
      --dark: #1a1433;
      --glow: rgba(255, 0, 255, 0.35);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: #fff;
      font-family: 'Press Start 2P', monospace;
      text-align: center;
      min-height: 100vh;
      background-image: 
        linear-gradient(rgba(57, 255, 20, 0.035) 1px, transparent 1px),
        linear-gradient(90deg, rgba(57, 255, 20, 0.035) 1px, transparent 1px);
      background-size: 32px 32px;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 15px 40px;
    }

    header {
      margin-bottom: 25px;
      width: 100%;
      max-width: 900px;
    }

    h1 {
      font-size: 3.5rem;
      line-height: 0.92;
      color: var(--accent-lime);
      text-shadow: 
        0 0 20px var(--accent-pink),
        0 0 8px var(--accent-lime),
        5px 5px 0 #000,
        -3px -3px 0 #000;
      letter-spacing: 4px;
      -webkit-text-stroke: 2.8px #000;
    }

    .viewer-container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto 35px;
      padding: 22px;
      background: var(--dark);
      border: 10px solid #000;
      box-shadow: 
        0 0 0 8px var(--accent-pink),
        0 0 0 16px var(--accent-lime),
        0 0 0 22px #000,
        0 0 65px var(--glow),
        inset 0 0 50px rgba(0, 0, 0, 0.88);
      border-radius: 4px;
      position: relative;
    }

    #viewer {
      width: 100%;
      min-height: 520px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 8px solid #111;
      position: relative;
    }

    #viewer img, 
    #viewer video {
      max-width: 100%;
      max-height: 520px;
      width: auto;
      height: auto;
      object-fit: contain;
      transition: opacity 0.5s ease;
    }

    .viewer-container.loading #viewer::after {
      content: 'SUMMONING CAT...';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--accent-lime);
      font-size: 1.05rem;
      letter-spacing: 4px;
      text-shadow: 0 0 15px var(--accent-lime);
      z-index: 15;
      animation: pulse 1.4s infinite;
    }

    .viewer-container.loading #viewer::before {
      content: '';
      position: absolute;
      width: 52px;
      height: 52px;
      border: 6px solid var(--accent-pink);
      border-top-color: var(--accent-lime);
      border-radius: 50%;
      animation: spin 0.85s linear infinite;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 16;
    }

    @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

    .type-label {
      position: absolute;
      top: 22px;
      right: 22px;
      background: rgba(0,0,0,0.92);
      color: var(--accent-lime);
      padding: 7px 20px;
      font-size: 0.75rem;
      border: 4px solid var(--accent-lime);
      text-transform: uppercase;
      letter-spacing: 3px;
      box-shadow: 0 0 12px #000;
      z-index: 20;
      transition: all 0.3s ease;
    }

    .status {
      margin: 18px 0 12px;
      color: #888;
      font-size: 0.9rem;
      letter-spacing: 1.5px;
      min-height: 24px;
    }

    .controls {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      gap: 28px;
      justify-content: center;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      font-family: 'Press Start 2P', monospace;
      font-size: 1.22rem;
      padding: 19px 38px;
      border: 7px solid #fff;
      background: #000;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.25, 0.9, 0.3, 1);
      box-shadow: 7px 7px 0 #fff;
      text-transform: uppercase;
      letter-spacing: 2px;
      min-width: 160px;
    }

    button:hover:not(:disabled) {
      transform: translate(-4px, -6px);
      box-shadow: 13px 13px 0 var(--accent-pink);
      background: var(--accent-pink);
      color: #000;
      border-color: var(--accent-pink);
    }

    button:active:not(:disabled) {
      transform: translate(3px, 3px);
      box-shadow: 4px 4px 0 #000;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: 7px 7px 0 #fff !important;
    }

    #nextBtn {
      font-size: 1.38rem;
      padding: 26px 52px;
      background: linear-gradient(45deg, var(--accent-lime), #00ff88);
      color: #000;
      border-color: #000;
      box-shadow: 8px 8px 0 #000;
      min-width: 340px;
      line-height: 1.25;
    }

    #nextBtn:hover:not(:disabled) {
      background: linear-gradient(45deg, #fff, var(--accent-lime));
      box-shadow: 14px 14px 0 #000;
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.6rem; letter-spacing: 3px; }
      #viewer { min-height: 390px; }
      button { padding: 17px 26px; font-size: 1.08rem; min-width: 130px; }
      #nextBtn { padding: 23px 38px; font-size: 1.28rem; min-width: 260px; }
      .controls { gap: 20px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>CAT<br>OH MY GOD</h1>
  </header>

  <div class="viewer-container" id="viewerContainer">
    <div id="viewer"></div>
    <div class="type-label" id="typeLabel">CAT MEDIA</div>
  </div>

  <div class="status" id="status">LOADING LEGENDARY CATS...</div>

  <div class="controls">
    <button id="prevBtn">← BACK</button>
    <button id="nextBtn">OH MY GOD ANOTHER ONE!</button>
    <button id="downloadBtn">↓ DOWNLOAD</button>
  </div>

  <script>
    const CONFIG = {
      owner: 'tooter9',
      repo: 'Youvideo',
      branch: 'main',
      path: 'cats/',
      extensions: /\.(jpe?g|png|gif|webp|mp4|webm|mov)$/i
    };

    let allFiles = [];
    let currentFile = null;
    let historyStack = [];
    let isLoading = false;

    const viewerContainer = document.getElementById('viewerContainer');
    const viewer = document.getElementById('viewer');
    const statusEl = document.getElementById('status');
    const typeLabel = document.getElementById('typeLabel');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    function getCache() {
      try {
        const cached = localStorage.getItem('catohmygodFiles');
        const time = localStorage.getItem('catohmygodTime');
        if (cached && time && Date.now() - parseInt(time) < 7 * 24 * 60 * 60 * 1000) {
          return JSON.parse(cached);
        }
      } catch (e) {}
      return null;
    }

    function saveCache(files) {
      try {
        localStorage.setItem('catohmygodFiles', JSON.stringify(files));
        localStorage.setItem('catohmygodTime', Date.now());
      } catch (e) {}
    }

    function getFileType(path) {
      const ext = path.split('.').pop().toLowerCase();
      return ['mp4', 'webm', 'mov'].includes(ext) ? 'VIDEO' : 'PHOTO';
    }

    function setLoading(state) {
      isLoading = state;
      viewerContainer.classList.toggle('loading', state);
      nextBtn.disabled = state;
      prevBtn.disabled = state || historyStack.length <= 1;
    }

    function createMedia(url, path) {
      viewer.innerHTML = '';
      const type = getFileType(path);

      if (type === 'VIDEO') {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        video.playsInline = true;
        viewer.appendChild(video);

        typeLabel.textContent = 'VIDEO';
        typeLabel.style.borderColor = '#00ffff';
        typeLabel.style.color = '#00ffff';
        return video;
      } else {
        const img = document.createElement('img');
        img.src = url;
        img.alt = 'legendary cat';
        viewer.appendChild(img);

        typeLabel.textContent = 'PHOTO';
        typeLabel.style.borderColor = '#39ff14';
        typeLabel.style.color = '#39ff14';
        return img;
      }
    }

    async function showMedia(path, addToHistory = true) {
      if (!path || isLoading || path === currentFile) return;

      setLoading(true);
      statusEl.textContent = 'SUMMONING NEXT LEGEND...';

      currentFile = path;
      if (addToHistory) {
        historyStack.push(path);
        if (historyStack.length > 25) historyStack.shift();
      }

      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;
      const media = createMedia(url, path);

      try {
        if (media.tagName === 'IMG') {
          await new Promise((res, rej) => {
            media.onload = res;
            media.onerror = rej;
          });
        } else {
          await new Promise((res, rej) => {
            media.onloadedmetadata = res;
            media.onerror = rej;
            setTimeout(() => rej(new Error('timeout')), 12000);
          });
        }
      } catch (e) {
        console.warn('Media load issue:', e);
      }

      media.style.opacity = '0';
      setTimeout(() => { media.style.opacity = '1'; }, 50);

      setTimeout(() => {
        statusEl.textContent = '';
        setLoading(false);
      }, 650);
    }

    function getRandomMedia() {
      if (!allFiles.length) return null;
      let idx;
      do {
        idx = Math.floor(Math.random() * allFiles.length);
      } while (allFiles[idx] === currentFile && allFiles.length > 1);
      return allFiles[idx];
    }

    async function fetchFiles() {
      statusEl.textContent = 'LOADING LEGENDARY CATS...';
      setLoading(true);

      const cached = getCache();
      if (cached && cached.length) {
        allFiles = cached;
        setLoading(false);
        const first = allFiles[Math.floor(Math.random() * allFiles.length)];
        historyStack = [];
        showMedia(first, true);
        return;
      }

      try {
        const refRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`);
        const ref = await refRes.json();
        const sha = ref.object.sha;

        const treeRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${sha}?recursive=1`);
        const data = await treeRes.json();

        allFiles = data.tree
          .filter(item => 
            item.type === 'blob' && 
            CONFIG.extensions.test(item.path) && 
            item.path.startsWith(CONFIG.path)
          )
          .map(item => item.path);

        saveCache(allFiles);
      } catch (e) {
        console.error(e);
        allFiles = getCache() || [];
        statusEl.textContent = allFiles.length ? 'USING CACHE' : 'NETWORK ERROR';
      }

      setLoading(false);
      if (allFiles.length && !currentFile) {
        const first = allFiles[Math.floor(Math.random() * allFiles.length)];
        historyStack = [];
        showMedia(first, true);
      }
    }

    nextBtn.addEventListener('click', () => {
      if (isLoading || !allFiles.length) return;
      const randomOne = getRandomMedia();
      if (randomOne) showMedia(randomOne, true);
    });

    prevBtn.addEventListener('click', () => {
      if (isLoading || historyStack.length < 2) return;
      historyStack.pop();
      const prevPath = historyStack[historyStack.length - 1];
      if (prevPath) showMedia(prevPath, false);
    });

    downloadBtn.addEventListener('click', () => {
      if (!currentFile) return;
      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${currentFile}`;
      const a = document.createElement('a');
      a.href = url;
      a.download = currentFile.split('/').pop();
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    document.addEventListener('keydown', e => {
      if (isLoading) return;
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        nextBtn.click();
      }
      if (e.key === 'ArrowLeft') prevBtn.click();
    });

    window.onload = () => {
      fetchFiles();
    };
  </script>
</body>
</html>
