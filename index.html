<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAT OH MY GOD</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>C</text></svg>" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg-primary:#0a0a0c;
  --bg-secondary:#111114;
  --bg-card:#18181b;
  --bg-hover:#222228;
  --border:#2a2a30;
  --border-hover:#3a3a44;
  --text-primary:#f0f0f2;
  --text-secondary:#8a8a96;
  --text-dim:#55555f;
  --accent:#e84393;
  --accent-hover:#fd79a8;
  --accent-glow:rgba(232,67,147,0.25);
  --select-color:#00b894;
  --select-glow:rgba(0,184,148,0.3);
  --tweet-color:#1da1f2;
  --radius:8px;
  --radius-lg:12px;
  --transition:0.18s ease;
}
html,body{height:100%;overflow:hidden}
body{
  font-family:'Space Grotesk',system-ui,-apple-system,sans-serif;
  background:var(--bg-primary);
  color:var(--text-primary);
  -webkit-font-smoothing:antialiased;
}
.app{display:flex;flex-direction:column;height:100vh}

header{
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 24px;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border);
  gap:12px;
  z-index:100;
}
.logo{display:flex;align-items:center;gap:10px;user-select:none}
.logo-icon{
  width:36px;height:36px;
  display:flex;align-items:center;justify-content:center;
}
.logo-icon svg{width:32px;height:32px}
.logo h1{
  font-size:18px;font-weight:700;letter-spacing:0.5px;
  background:linear-gradient(135deg,var(--accent),#a855f7);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
}
.header-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.header-stats{
  font-size:12px;color:var(--text-secondary);font-weight:500;
  padding:0 8px;
}

.btn{
  font-family:inherit;font-size:12px;font-weight:600;
  padding:8px 16px;border:1px solid var(--border);
  border-radius:var(--radius);cursor:pointer;
  background:var(--bg-card);color:var(--text-primary);
  display:inline-flex;align-items:center;gap:6px;
  transition:all var(--transition);
  user-select:none;white-space:nowrap;
}
.btn:hover{background:var(--bg-hover);border-color:var(--border-hover)}
.btn:active{transform:scale(0.97)}
.btn[disabled]{opacity:0.4;pointer-events:none}
.btn svg{width:14px;height:14px;flex-shrink:0}

.btn-accent{
  background:var(--accent);border-color:var(--accent);color:#fff;
}
.btn-accent:hover{background:var(--accent-hover);border-color:var(--accent-hover)}

.btn-select{
  background:var(--select-color);border-color:var(--select-color);color:#fff;
}
.btn-select:hover{filter:brightness(1.1)}

.btn-tweet{
  background:transparent;border-color:var(--tweet-color);color:var(--tweet-color);
}
.btn-tweet:hover{background:var(--tweet-color);color:#fff}

#downloadBtn{display:none}
#selectionCount{
  font-size:12px;font-weight:600;color:var(--select-color);
  min-width:0;
}

.toolbar{
  flex-shrink:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 24px;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border);
  gap:12px;
}
.toolbar-left{display:flex;align-items:center;gap:12px}
.toolbar-right{display:flex;align-items:center;gap:8px}
.view-info{font-size:11px;color:var(--text-dim);font-weight:500}

.scroll-controls{display:flex;align-items:center;gap:4px}
.scroll-controls .btn{padding:6px 10px;font-size:11px}

.gallery-wrap{flex:1;overflow:hidden;position:relative}

#gallery{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:4px;
  padding:4px;
  overflow-y:auto;
  height:100%;
  scroll-behavior:auto;
}
#gallery::-webkit-scrollbar{width:6px}
#gallery::-webkit-scrollbar-track{background:var(--bg-primary)}
#gallery::-webkit-scrollbar-thumb{
  background:var(--border-hover);border-radius:3px;
}
#gallery::-webkit-scrollbar-thumb:hover{background:var(--text-dim)}

.card{
  position:relative;
  aspect-ratio:1;
  overflow:hidden;
  border-radius:var(--radius);
  background:var(--bg-card);
  cursor:pointer;
  transition:transform var(--transition),box-shadow var(--transition);
}
.card:hover{transform:scale(1.02);z-index:2;box-shadow:0 8px 32px rgba(0,0,0,0.4)}
.card img{
  width:100%;height:100%;object-fit:cover;display:block;
  transition:filter var(--transition);
}
.card:hover img{filter:brightness(1.08)}

.card-actions{
  position:absolute;inset:0;
  background:linear-gradient(180deg,rgba(0,0,0,0) 40%,rgba(0,0,0,0.65) 100%);
  display:flex;align-items:flex-end;justify-content:space-between;
  padding:8px;opacity:0;
  transition:opacity var(--transition);
  pointer-events:none;
}
.card:hover .card-actions{opacity:1;pointer-events:auto}

.card-check{
  width:22px;height:22px;border-radius:50%;
  border:2px solid rgba(255,255,255,0.5);
  background:rgba(0,0,0,0.3);
  display:flex;align-items:center;justify-content:center;
  transition:all 0.12s;
}
.card-check svg{width:12px;height:12px;opacity:0;transition:opacity 0.12s}

.card-tweet{
  width:28px;height:28px;border-radius:50%;
  border:none;background:rgba(0,0,0,0.4);
  color:#fff;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  padding:0;transition:all 0.12s;
}
.card-tweet svg{width:14px;height:14px}
.card-tweet:hover{background:var(--tweet-color)}

body.select-mode .card-actions{opacity:1;pointer-events:auto}
body.select-mode .card{cursor:crosshair}

.card.selected{
  box-shadow:0 0 0 3px var(--select-color),0 0 20px var(--select-glow);
  transform:scale(0.97);
}
.card.selected .card-check{
  background:var(--select-color);border-color:var(--select-color);
}
.card.selected .card-check svg{opacity:1}

.card-skeleton{
  aspect-ratio:1;border-radius:var(--radius);
  background:var(--bg-card);
  animation:shimmer 1.5s ease-in-out infinite;
}
@keyframes shimmer{
  0%{opacity:0.5}50%{opacity:0.8}100%{opacity:0.5}
}

.empty-state{
  display:none;flex-direction:column;align-items:center;justify-content:center;
  gap:16px;padding:60px 24px;text-align:center;
  position:absolute;inset:0;
}
.empty-state.visible{display:flex}
.empty-state svg{width:64px;height:64px;color:var(--text-dim)}
.empty-state p{font-size:14px;color:var(--text-secondary);max-width:320px;line-height:1.6}
.empty-state strong{font-size:16px;color:var(--text-primary)}

footer{
  flex-shrink:0;
  padding:10px 24px;
  background:var(--bg-secondary);
  border-top:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  gap:12px;
}
.footer-left{display:flex;align-items:center;gap:12px}
.footer-right{display:flex;align-items:center;gap:8px}
.status{
  display:flex;align-items:center;gap:6px;
  font-size:11px;color:var(--text-dim);font-weight:500;
}
.status-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--select-color);flex-shrink:0;
}
.folder-badge{
  font-size:10px;font-weight:600;
  padding:3px 8px;border-radius:4px;
  background:var(--bg-card);border:1px solid var(--border);
  color:var(--text-secondary);
}

@media(max-width:900px){
  #gallery{grid-template-columns:repeat(4,1fr)}
}
@media(max-width:680px){
  #gallery{grid-template-columns:repeat(3,1fr)}
  header{padding:10px 14px}
  .toolbar{padding:8px 14px}
  footer{padding:8px 14px}
  .logo h1{font-size:14px}
}
@media(max-width:440px){
  #gallery{grid-template-columns:repeat(2,1fr)}
}
  </style>
</head>
<body>
<div class="app">

  <header>
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 52V24L16 8h4l-4 16h8L20 8h4l8 16V52c0 2-1 4-4 4H12c-2 0-4-2-4-4z" fill="#e84393"/>
          <path d="M36 52V24l8-16h4l-4 16h8l-4-16h4l8 16V52c0 2-2 4-4 4H40c-2 0-4-2-4-4z" fill="#a855f7"/>
          <circle cx="18" cy="36" r="3" fill="#fff"/>
          <circle cx="46" cy="36" r="3" fill="#fff"/>
          <path d="M26 42c0 0 3 4 6 4s6-4 6-4" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <h1>CAT OH MY GOD</h1>
    </div>
    <div class="header-actions">
      <span id="selectionCount"></span>
      <button id="selectBtn" class="btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
        Select
      </button>
      <button id="downloadBtn" class="btn btn-select">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download ZIP
      </button>
    </div>
  </header>

  <div class="toolbar">
    <div class="toolbar-left">
      <span class="view-info" id="imageCount">0 images</span>
      <div id="folderBadges"></div>
    </div>
    <div class="toolbar-right">
      <div class="scroll-controls">
        <button id="scrollTopBtn" class="btn" title="Scroll to top">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
        </button>
        <button id="scrollToggle" class="btn" title="Toggle auto-scroll">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          Auto
        </button>
      </div>
    </div>
  </div>

  <div class="gallery-wrap">
    <div id="gallery"></div>
    <div class="empty-state" id="emptyState">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <polyline points="21 15 16 10 5 21"/>
      </svg>
      <strong>No images found</strong>
      <p>Add your cat images to the <code>cats/</code> folder, then run <code>node build.js</code> to generate the manifest.</p>
    </div>
  </div>

  <footer>
    <div class="footer-left">
      <div class="status">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Ready</span>
      </div>
    </div>
    <div class="footer-right">
      <button id="shuffleBtn" class="btn" title="Shuffle order">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
        Shuffle
      </button>
    </div>
  </footer>

</div>

<script>
"use strict";

var MANIFEST_URL = "cats-manifest.json";
var CACHE_KEY = "comg_manifest";
var CACHE_TTL = 24 * 60 * 60 * 1000;

var gallery = document.getElementById("gallery");
var selectedIds = new Set();
var allPaths = [];
var isSelectMode = false;
var autoScrollEnabled = false;
var autoScrollId = null;
var scrollSpeed = 0.6;
var longPressTimer = null;
var longPressFired = false;

function getCachedManifest() {
  try {
    var raw = localStorage.getItem(CACHE_KEY);
    if (!raw) return null;
    var entry = JSON.parse(raw);
    if (Date.now() - entry.ts > CACHE_TTL) {
      localStorage.removeItem(CACHE_KEY);
      return null;
    }
    return entry.data;
  } catch (e) {
    return null;
  }
}

function cacheManifest(data) {
  try {
    localStorage.setItem(CACHE_KEY, JSON.stringify({ data: data, ts: Date.now() }));
  } catch (e) {}
}

async function loadManifest() {
  var cached = getCachedManifest();
  if (cached) {
    setStatus("Loaded from cache");
    return cached;
  }

  try {
    var res = await fetch(MANIFEST_URL + "?_=" + Date.now());
    if (!res.ok) throw new Error(res.status.toString());
    var data = await res.json();
    cacheManifest(data);
    setStatus("Manifest loaded");
    return data;
  } catch (e) {
    setStatus("Manifest not found");
    return { folders: [], images: [] };
  }
}

function setStatus(text) {
  document.getElementById("statusText").textContent = text;
}

function updateImageCount() {
  document.getElementById("imageCount").textContent = allPaths.length + " images";
}

function renderFolderBadges(folders) {
  var container = document.getElementById("folderBadges");
  container.innerHTML = "";
  folders.forEach(function (f) {
    var span = document.createElement("span");
    span.className = "folder-badge";
    span.textContent = f;
    container.appendChild(span);
  });
}

function createCard(path, index) {
  var card = document.createElement("div");
  card.className = "card";
  card.dataset.index = index.toString();
  card.dataset.path = path;

  var img = document.createElement("img");
  img.src = path;
  img.alt = "";
  img.loading = "lazy";
  img.draggable = false;
  img.onerror = function () {
    card.style.display = "none";
  };

  var actions = document.createElement("div");
  actions.className = "card-actions";

  var check = document.createElement("div");
  check.className = "card-check";
  check.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';

  var tweet = document.createElement("button");
  tweet.className = "card-tweet";
  tweet.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>';
  tweet.title = "Tweet this cat";
  tweet.addEventListener("click", function (e) {
    e.stopPropagation();
    e.preventDefault();
    tweetImage(path);
  });

  actions.appendChild(check);
  actions.appendChild(tweet);
  card.appendChild(img);
  card.appendChild(actions);

  card.addEventListener("pointerdown", function (e) {
    if (e.button !== 0) return;
    longPressFired = false;
    longPressTimer = setTimeout(function () {
      longPressFired = true;
      if (!isSelectMode) enterSelectMode();
      toggleCardSelection(card, path);
    }, 500);
  });

  card.addEventListener("pointerup", function () {
    if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
  });

  card.addEventListener("pointercancel", function () {
    if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
  });

  card.addEventListener("pointermove", function () {
    if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
  });

  card.addEventListener("click", function (e) {
    if (longPressFired) { e.preventDefault(); return; }
    if (isSelectMode) {
      e.preventDefault();
      toggleCardSelection(card, path);
    }
  });

  return card;
}

function renderGallery(paths) {
  gallery.innerHTML = "";
  if (paths.length === 0) {
    document.getElementById("emptyState").classList.add("visible");
    return;
  }
  document.getElementById("emptyState").classList.remove("visible");

  var fragment = document.createDocumentFragment();
  paths.forEach(function (p, i) {
    fragment.appendChild(createCard(p, i));
  });
  gallery.appendChild(fragment);
}

function toggleCardSelection(card, path) {
  if (selectedIds.has(path)) {
    selectedIds.delete(path);
    card.classList.remove("selected");
  } else {
    selectedIds.add(path);
    card.classList.add("selected");
  }
  refreshSelectionUI();
}

function enterSelectMode() {
  isSelectMode = true;
  document.body.classList.add("select-mode");
  var btn = document.getElementById("selectBtn");
  btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> Cancel';
}

function exitSelectMode() {
  isSelectMode = false;
  document.body.classList.remove("select-mode");
  selectedIds.clear();
  document.querySelectorAll(".card.selected").forEach(function (el) {
    el.classList.remove("selected");
  });
  var btn = document.getElementById("selectBtn");
  btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg> Select';
  refreshSelectionUI();
}

function refreshSelectionUI() {
  var counter = document.getElementById("selectionCount");
  var dlBtn = document.getElementById("downloadBtn");
  var count = selectedIds.size;
  counter.textContent = count > 0 ? count + " selected" : "";
  dlBtn.style.display = count > 0 ? "inline-flex" : "none";
}

async function downloadSelected() {
  if (selectedIds.size === 0) return;

  var dlBtn = document.getElementById("downloadBtn");
  var origHTML = dlBtn.innerHTML;
  dlBtn.innerHTML = "Packing...";
  dlBtn.disabled = true;
  setStatus("Creating ZIP...");

  try {
    var zip = new JSZip();
    var arr = Array.from(selectedIds);

    await Promise.all(arr.map(function (path, i) {
      return fetch(path).then(function (r) { return r.blob(); }).then(function (blob) {
        var name = path.split("/").pop() || ("cat_" + (i + 1) + ".jpg");
        zip.file(name, blob);
      }).catch(function () {});
    }));

    var content = await zip.generateAsync({ type: "blob" });
    var url = URL.createObjectURL(content);
    var a = document.createElement("a");
    a.href = url;
    a.download = "cat_oh_my_god.zip";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    setStatus("ZIP downloaded");
  } catch (e) {
    setStatus("ZIP failed");
  }

  dlBtn.innerHTML = origHTML;
  dlBtn.disabled = false;
}

function tweetImage(path) {
  var fullUrl = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, "/") + path;
  var text = encodeURIComponent("Check out this cat! #CatOhMyGod #Cats");
  var url = encodeURIComponent(fullUrl);
  window.open("https://twitter.com/intent/tweet?text=" + text + "&url=" + url, "_blank", "noopener");
}

function shuffleArray(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
  }
  return arr;
}

function startAutoScroll() {
  if (autoScrollId) return;
  function tick() {
    gallery.scrollTop += scrollSpeed;
    autoScrollId = requestAnimationFrame(tick);
  }
  autoScrollId = requestAnimationFrame(tick);
}

function stopAutoScroll() {
  if (autoScrollId) {
    cancelAnimationFrame(autoScrollId);
    autoScrollId = null;
  }
}

function toggleAutoScroll() {
  autoScrollEnabled = !autoScrollEnabled;
  var btn = document.getElementById("scrollToggle");
  if (autoScrollEnabled) {
    startAutoScroll();
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg> Pause';
  } else {
    stopAutoScroll();
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg> Auto';
  }
}

gallery.addEventListener("pointerenter", function () {
  if (autoScrollEnabled) stopAutoScroll();
});
gallery.addEventListener("pointerleave", function () {
  if (autoScrollEnabled) startAutoScroll();
});
gallery.addEventListener("touchstart", function () {
  if (autoScrollEnabled) stopAutoScroll();
}, { passive: true });
gallery.addEventListener("touchend", function () {
  if (autoScrollEnabled) setTimeout(startAutoScroll, 2000);
});

document.getElementById("selectBtn").addEventListener("click", function () {
  if (isSelectMode) exitSelectMode(); else enterSelectMode();
});

document.getElementById("downloadBtn").addEventListener("click", function () {
  downloadSelected();
});

document.getElementById("scrollTopBtn").addEventListener("click", function () {
  gallery.scrollTo({ top: 0, behavior: "smooth" });
});

document.getElementById("scrollToggle").addEventListener("click", function () {
  toggleAutoScroll();
});

document.getElementById("shuffleBtn").addEventListener("click", function () {
  shuffleArray(allPaths);
  renderGallery(allPaths);
  setStatus("Shuffled");
});

document.addEventListener("DOMContentLoaded", async function () {
  setStatus("Loading...");
  var manifest = await loadManifest();
  allPaths = manifest.images || [];
  var folders = manifest.folders || [];
  renderFolderBadges(folders);
  updateImageCount();
  renderGallery(allPaths);
  if (allPaths.length === 0) {
    setStatus("No images - run build.js");
  }
});
</script>
</body>
</html>
