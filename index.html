<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>catohmygod</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    :root {
      --bg: #0b0814;
      --accent-pink: #ff00ff;
      --accent-lime: #39ff14;
      --dark: #1a1433;
      --glow: rgba(255, 0, 255, 0.35);
    }

    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    body {
      background: var(--bg);
      color: #fff;
      font-family: 'Press Start 2P', monospace;
      text-align: center;
      min-height: 100vh;
      background-image: 
        linear-gradient(rgba(57, 255, 20, 0.035) 1px, transparent 1px),
        linear-gradient(90deg, rgba(57, 255, 20, 0.035) 1px, transparent 1px);
      background-size: 32px 32px;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 15px 40px;
    }

    header {
      margin-bottom: 30px;
      width: 100%;
      max-width: 900px;
    }

    h1 {
      font-size: 4.1rem;
      line-height: 0.88;
      color: var(--accent-lime);
      text-shadow: 
        0 0 22px var(--accent-pink),
        7px 7px 0 #000,
        -3px -3px 0 #000;
      letter-spacing: 6px;
      -webkit-text-stroke: 3.5px #000;
    }

    .viewer-container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto 35px;
      padding: 20px;
      background: var(--dark);
      border: 14px solid #000;
      box-shadow: 
        0 0 0 18px var(--accent-pink),
        0 0 70px var(--glow),
        inset 0 0 55px rgba(0, 0, 0, 0.9);
      border-radius: 6px;
      position: relative;
    }

    #viewer {
      width: 100%;
      min-height: 520px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 7px solid #111;
    }

    #viewer img, 
    #viewer video {
      max-width: 100%;
      max-height: 520px;
      width: auto;
      height: auto;
      object-fit: contain;
      transition: opacity 0.4s ease;
    }

    .type-label {
      position: absolute;
      top: 22px;
      right: 22px;
      background: rgba(0,0,0,0.92);
      color: var(--accent-lime);
      padding: 7px 20px;
      font-size: 0.75rem;
      border: 4px solid var(--accent-lime);
      text-transform: uppercase;
      letter-spacing: 3px;
      box-shadow: 0 0 12px #000;
      z-index: 10;
    }

    .status {
      margin: 18px 0 8px;
      color: #888;
      font-size: 0.9rem;
      letter-spacing: 1.5px;
      min-height: 24px;
    }

    .controls {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      gap: 25px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      font-family: 'Press Start 2P', monospace;
      font-size: 1.2rem;
      padding: 19px 42px;
      border: 7px solid #fff;
      background: #000;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.25, 0.9, 0.3, 1);
      box-shadow: 7px 7px 0 #fff;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    button:hover {
      transform: translate(-4px, -6px);
      box-shadow: 13px 13px 0 var(--accent-pink);
      background: var(--accent-pink);
      color: #000;
      border-color: var(--accent-pink);
    }

    button:active {
      transform: translate(3px, 3px);
      box-shadow: 4px 4px 0 #000;
    }

    #nextBtn {
      font-size: 1.6rem;
      padding: 26px 68px;
      background: linear-gradient(45deg, var(--accent-lime), #00ff88);
      color: #000;
      border-color: #000;
      box-shadow: 8px 8px 0 #000;
    }

    #nextBtn:hover {
      background: linear-gradient(45deg, #fff, var(--accent-lime));
      box-shadow: 14px 14px 0 #000;
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.85rem; letter-spacing: 4px; }
      #viewer { min-height: 390px; }
      button { padding: 16px 28px; font-size: 1.05rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>CAT<br>OH MY GOD</h1>
  </header>

  <div class="viewer-container">
    <div id="viewer"></div>
    <div class="type-label" id="typeLabel">CAT MEDIA</div>
  </div>

  <div class="status" id="status">LOADING LEGENDARY CATS...</div>

  <div class="controls">
    <button id="prevBtn">← BACK</button>
    <button id="nextBtn">OH MY GOD ANOTHER ONE!</button>
    <button id="downloadBtn">↓ DOWNLOAD</button>
  </div>

  <script>
    const CONFIG = {
      owner: 'tooter9',
      repo: 'Youvideo',
      branch: 'main',
      path: 'cats/',
      extensions: /\.(jpe?g|png|gif|webp|mp4|webm|mov)$/i
    };

    let allFiles = [];
    let currentFile = null;
    let historyStack = [];
    let isLoading = false;

    const viewer = document.getElementById('viewer');
    const statusEl = document.getElementById('status');
    const typeLabel = document.getElementById('typeLabel');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    function getCache() {
      try {
        const cached = localStorage.getItem('catohmygodFiles');
        const time = localStorage.getItem('catohmygodTime');
        if (cached && time && Date.now() - parseInt(time) < 7 * 24 * 60 * 60 * 1000) {
          return JSON.parse(cached);
        }
      } catch (e) {}
      return null;
    }

    function saveCache(files) {
      try {
        localStorage.setItem('catohmygodFiles', JSON.stringify(files));
        localStorage.setItem('catohmygodTime', Date.now());
      } catch (e) {}
    }

    function getFileType(path) {
      const ext = path.split('.').pop().toLowerCase();
      return ['mp4', 'webm', 'mov'].includes(ext) ? 'VIDEO' : 'PHOTO';
    }

    function createMedia(url, path) {
      viewer.innerHTML = '';
      const type = getFileType(path);

      if (type === 'VIDEO') {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        viewer.appendChild(video);
        typeLabel.textContent = 'VIDEO';
        typeLabel.style.borderColor = '#00ffff';
        typeLabel.style.color = '#00ffff';
      } else {
        const img = document.createElement('img');
        img.src = url;
        img.alt = 'cat';
        viewer.appendChild(img);
        typeLabel.textContent = 'PHOTO';
        typeLabel.style.borderColor = '#39ff14';
        typeLabel.style.color = '#39ff14';
      }
    }

    function showMedia(path) {
      if (!path) return;
      currentFile = path;
      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;
      
      createMedia(url, path);

      if (!historyStack.includes(path)) {
        historyStack.push(path);
        if (historyStack.length > 20) historyStack.shift();
      }

      prevBtn.disabled = historyStack.length <= 1;
    }

    function getRandomMedia() {
      if (!allFiles.length) return null;
      let idx;
      do {
        idx = Math.floor(Math.random() * allFiles.length);
      } while (allFiles[idx] === currentFile && allFiles.length > 1);
      return allFiles[idx];
    }

    async function fetchFiles() {
      statusEl.textContent = 'LOADING LEGENDARY CATS...';
      isLoading = true;

      const cached = getCache();
      if (cached && cached.length) {
        allFiles = cached;
        statusEl.textContent = 'READY.';
        isLoading = false;
        showMedia(allFiles[Math.floor(Math.random() * allFiles.length)]);
        return;
      }

      try {
        const refRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`);
        const ref = await refRes.json();
        const sha = ref.object.sha;

        const treeRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${sha}?recursive=1`);
        const data = await treeRes.json();

        allFiles = data.tree
          .filter(item => 
            item.type === 'blob' && 
            CONFIG.extensions.test(item.path) && 
            item.path.startsWith(CONFIG.path)
          )
          .map(item => item.path);

        allFiles.sort(() => Math.random() - 0.5);
        saveCache(allFiles);

        statusEl.textContent = 'READY.';
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'ERROR. USING CACHE...';
        allFiles = getCache() || [];
        if (allFiles.length) statusEl.textContent = 'READY.';
      }

      isLoading = false;
      if (allFiles.length && !currentFile) {
        showMedia(allFiles[Math.floor(Math.random() * allFiles.length)]);
      }
    }

    nextBtn.addEventListener('click', () => {
      if (isLoading || !allFiles.length) return;
      const randomOne = getRandomMedia();
      if (randomOne) showMedia(randomOne);
    });

    prevBtn.addEventListener('click', () => {
      if (historyStack.length < 2 || isLoading) return;
      historyStack.pop();
      const prev = historyStack[historyStack.length - 1];
      if (prev) showMedia(prev);
    });

    downloadBtn.addEventListener('click', () => {
      if (!currentFile) return;
      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${currentFile}`;
      const a = document.createElement('a');
      a.href = url;
      a.download = currentFile.split('/').pop();
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    document.addEventListener('keydown', e => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        nextBtn.click();
      }
      if (e.key === 'ArrowLeft') prevBtn.click();
    });

    window.onload = () => {
      fetchFiles();
    };
  </script>
</body>
</html>
