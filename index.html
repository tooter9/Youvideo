<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>catohmygod</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    :root {
      --bg: #0b0814;
      --accent-pink: #ff00ff;
      --accent-lime: #39ff14;
      --gold: #ffcc00;
      --dark: #1a1433;
      --glow: rgba(255, 0, 255, 0.4);
    }

    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    body {
      background: var(--bg);
      color: #fff;
      font-family: 'Press Start 2P', monospace;
      text-align: center;
      min-height: 100vh;
      background-image: 
        linear-gradient(rgba(57, 255, 20, 0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(57, 255, 20, 0.04) 1px, transparent 1px);
      background-size: 32px 32px;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
    }

    header {
      margin-bottom: 25px;
      width: 100%;
      max-width: 920px;
    }

    h1 {
      font-size: 4.2rem;
      line-height: 0.9;
      margin-bottom: 6px;
      color: var(--accent-lime);
      text-shadow: 
        0 0 20px var(--accent-pink),
        8px 8px 0 #000,
        -4px -4px 0 #000;
      letter-spacing: 8px;
      -webkit-text-stroke: 4px #000;
    }

    .subtitle {
      color: var(--accent-pink);
      font-size: 1.15rem;
      letter-spacing: 7px;
      text-shadow: 0 0 15px var(--accent-pink);
    }

    .viewer-container {
      width: 100%;
      max-width: 920px;
      margin: 20px auto 30px;
      padding: 18px;
      background: var(--dark);
      border: 12px solid #000;
      box-shadow: 
        0 0 0 16px var(--accent-pink),
        0 0 80px var(--glow),
        inset 0 0 60px rgba(0, 0, 0, 0.95);
      position: relative;
      border-radius: 8px;
    }

    #viewer {
      width: 100%;
      min-height: 520px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      border: 6px solid #111;
    }

    #viewer img, 
    #viewer video {
      max-width: 100%;
      max-height: 520px;
      width: auto;
      height: auto;
      object-fit: contain;
      transition: opacity 0.35s ease;
    }

    .type-label {
      position: absolute;
      top: 18px;
      right: 18px;
      background: rgba(0,0,0,0.9);
      color: var(--accent-lime);
      padding: 8px 18px;
      font-size: 0.78rem;
      border: 4px solid var(--accent-lime);
      text-transform: uppercase;
      letter-spacing: 3px;
      box-shadow: 0 0 15px #000;
      z-index: 5;
    }

    .controls {
      max-width: 920px;
      margin: 0 auto;
      display: flex;
      gap: 22px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      font-family: 'Press Start 2P', monospace;
      font-size: 1.15rem;
      padding: 18px 38px;
      border: 6px solid #fff;
      background: #000;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.23, 1, 0.32, 1);
      box-shadow: 6px 6px 0 #fff;
      text-transform: uppercase;
      letter-spacing: 2px;
      min-width: 180px;
    }

    button:hover {
      transform: translate(-4px, -6px);
      box-shadow: 12px 12px 0 var(--accent-pink);
      background: var(--accent-pink);
      color: #000;
      border-color: var(--accent-pink);
    }

    button:active {
      transform: translate(2px, 2px);
      box-shadow: 4px 4px 0 #000;
    }

    #nextBtn {
      font-size: 1.55rem;
      padding: 24px 62px;
      background: linear-gradient(45deg, var(--accent-lime), #00ff88);
      color: #000;
      border-color: #000;
      box-shadow: 8px 8px 0 #000;
      min-width: 320px;
    }

    #nextBtn:hover {
      background: linear-gradient(45deg, #fff, var(--accent-lime));
      box-shadow: 12px 12px 0 #000;
    }

    .status {
      margin: 20px 0 12px;
      color: #aaa;
      font-size: 0.92rem;
      min-height: 26px;
      letter-spacing: 1px;
    }

    .filename {
      margin-top: 8px;
      font-size: 0.82rem;
      color: #666;
      word-break: break-all;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.8rem; }
      #viewer { min-height: 380px; }
      button { padding: 14px 24px; font-size: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>CAT<br>OH MY GOD</h1>
    <p class="subtitle">catohmygod edition</p>
  </header>

  <div class="viewer-container">
    <div id="viewer"></div>
    <div class="type-label" id="typeLabel">CAT MEDIA</div>
  </div>

  <div class="status" id="status">ЗАГРУЗКА ЛЕГЕНДАРНЫХ КОТОВ...</div>
  <div class="filename" id="filename"></div>

  <div class="controls">
    <button id="prevBtn">← НАЗАД</button>
    <button id="nextBtn">ОХ MY GOD ЕЩЁ ОДНОГО!</button>
    <button id="downloadBtn">↓ СКАЧАТЬ</button>
  </div>

  <script>
    const CONFIG = {
      owner: 'tooter9',
      repo: 'Youvideo',
      branch: 'main',
      path: 'cats/',
      extensions: /\.(jpe?g|png|gif|webp|mp4|webm|mov)$/i
    };

    let allFiles = [];
    let currentFile = null;
    let historyStack = [];
    let isLoading = false;

    const viewer = document.getElementById('viewer');
    const statusEl = document.getElementById('status');
    const filenameEl = document.getElementById('filename');
    const typeLabel = document.getElementById('typeLabel');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    function getCache() {
      try {
        const cached = localStorage.getItem('catohmygodFiles');
        const time = localStorage.getItem('catohmygodTime');
        if (cached && time && Date.now() - parseInt(time) < 7 * 24 * 60 * 60 * 1000) {
          return JSON.parse(cached);
        }
      } catch (e) {}
      return null;
    }

    function saveCache(files) {
      try {
        localStorage.setItem('catohmygodFiles', JSON.stringify(files));
        localStorage.setItem('catohmygodTime', Date.now());
      } catch (e) {}
    }

    function getFileType(path) {
      const ext = path.split('.').pop().toLowerCase();
      return ['mp4', 'webm', 'mov'].includes(ext) ? 'VIDEO' : 'PHOTO';
    }

    function createMedia(url, path) {
      viewer.innerHTML = '';
      const type = getFileType(path);

      if (type === 'VIDEO') {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        video.style.maxHeight = '520px';
        viewer.appendChild(video);
        typeLabel.textContent = 'VIDEO';
        typeLabel.style.borderColor = '#00ffff';
        typeLabel.style.color = '#00ffff';
      } else {
        const img = document.createElement('img');
        img.src = url;
        img.alt = 'catohmygod';
        viewer.appendChild(img);
        typeLabel.textContent = 'PHOTO';
        typeLabel.style.borderColor = '#39ff14';
        typeLabel.style.color = '#39ff14';
      }
    }

    function showMedia(path) {
      if (!path) return;
      currentFile = path;
      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;
      
      createMedia(url, path);
      filenameEl.textContent = path.split('/').pop() || 'cat.media';

      if (!historyStack.includes(path)) {
        historyStack.push(path);
        if (historyStack.length > 20) historyStack.shift();
      }

      prevBtn.disabled = historyStack.length <= 1;
    }

    function getRandomMedia() {
      if (!allFiles.length) return null;
      let attempts = 0;
      let idx;
      do {
        idx = Math.floor(Math.random() * allFiles.length);
        attempts++;
      } while (allFiles[idx] === currentFile && allFiles.length > 1 && attempts < 30);
      return allFiles[idx];
    }

    async function fetchFiles() {
      statusEl.textContent = 'СКАНИРУЕМ ВИДЕО И ФОТКИ КОТОВ...';
      isLoading = true;

      const cached = getCache();
      if (cached && cached.length) {
        allFiles = cached;
        statusEl.textContent = `${allFiles.length} КОТОВ ЗАГРУЖЕНО ИЗ КЭША`;
        isLoading = false;
        showMedia(allFiles[0]);
        return;
      }

      try {
        const refRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`);
        const ref = await refRes.json();
        const sha = ref.object.sha;

        const treeRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${sha}?recursive=1`);
        const data = await treeRes.json();

        allFiles = data.tree
          .filter(item => 
            item.type === 'blob' && 
            CONFIG.extensions.test(item.path) && 
            item.path.startsWith(CONFIG.path)
          )
          .map(item => item.path);

        allFiles.sort(() => Math.random() - 0.5);
        saveCache(allFiles);

        statusEl.textContent = `${allFiles.length} КОТОВ ГОТОВЫ. OH MY GOD!`;
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'ОШИБКА. ИСПОЛЬЗУЕМ КЭШ...';
        allFiles = getCache() || [];
      }

      isLoading = false;
      if (allFiles.length) showMedia(allFiles[0]);
    }

    // Кнопки
    nextBtn.addEventListener('click', () => {
      if (isLoading || !allFiles.length) return;
      const randomOne = getRandomMedia();
      if (randomOne) showMedia(randomOne);
    });

    prevBtn.addEventListener('click', () => {
      if (historyStack.length < 2 || isLoading) return;
      historyStack.pop(); // убираем текущий
      const prev = historyStack[historyStack.length - 1];
      if (prev) showMedia(prev);
    });

    downloadBtn.addEventListener('click', () => {
      if (!currentFile) return;
      const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${currentFile}`;
      const a = document.createElement('a');
      a.href = url;
      a.download = currentFile.split('/').pop();
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    // Клавиатура
    document.addEventListener('keydown', e => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        nextBtn.click();
      }
      if (e.key === 'ArrowLeft') prevBtn.click();
    });

    // Старт
    window.onload = () => {
      fetchFiles();
    };
  </script>
</body>
</html>
