<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thousands of Cats ‚Äì Private Gallery</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --text: #e0e0e0;
      --accent: #ff79c6;
      --card: #1e1e1e;
    }
    body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      text-align: center;
    }
    h1 { color: var(--accent); margin: 1em 0; }
    #status { color: #888; margin: 2em; font-size: 1.1em; }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
      max-width: 1800px;
      margin: 0 auto;
    }
    .item {
      background: var(--card);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      transition: transform 0.18s;
      opacity: 0;
      transform: translateY(20px);
    }
    .item.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .item:hover { transform: scale(1.03); }
    img {
      width: 100%;
      height: auto;
      display: block;
      loading: lazy;
    }
    #loadMore {
      margin: 3em auto;
      padding: 12px 30px;
      font-size: 1.1em;
      background: var(--accent);
      color: black;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }
    #loadMore:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <h1>üê± My Cats Collection (Thousands Mode) üêæ</h1>
  <div id="status">Loading cat list... (big collection, please wait)</div>

  <div class="gallery" id="gallery"></div>
  <button id="loadMore">Load more cats</button>

  <script>
    const CONFIG = {
      owner: 'YOUR_GITHUB_USERNAME',     // ‚Üê –∑–∞–º–µ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
      repo:  'YOUR_REPO_NAME',            // ‚Üê –Ω–∞–ø—Ä–∏–º–µ—Ä cats-gallery
      branch: 'main',
      basePath: 'cats/',                  // –≤—Å–µ —Ñ–æ—Ç–æ –≤ –ø–æ–¥–ø–∞–ø–∫–∞—Ö cats/...
      extensions: /\.(jpe?g|png|gif|webp)$/i
    };

    let allFiles = [];          // –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º
    let displayedIndex = 0;     // —Å–∫–æ–ª—å–∫–æ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–æ
    const BATCH_SIZE = 60;      // —Å–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞ —Ä–∞–∑ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

    const gallery = document.getElementById('gallery');
    const status = document.getElementById('status');
    const loadMoreBtn = document.getElementById('loadMore');

    // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∫—ç—à –∏–∑ localStorage (—á—Ç–æ–±—ã –Ω–µ –¥–æ–ª–±–∏—Ç—å API –∫–∞–∂–¥—ã–π —Ä–∞–∑)
    function loadCachedList() {
      try {
        const cached = localStorage.getItem('catsFileList');
        const timestamp = localStorage.getItem('catsCacheTime');
        if (cached && Date.now() - timestamp < 24*60*60*1000) { // 24 —á–∞—Å–∞
          return JSON.parse(cached);
        }
      } catch {}
      return null;
    }

    async function fetchFileList() {
      status.textContent = 'Fetching file tree from GitHub...';
      try {
        // 1. –ü–æ–ª—É—á–∞–µ–º SHA –≤–µ—Ç–∫–∏
        const ref = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`).then(r => r.json());
        const treeSha = ref.object.sha;

        // 2. –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ
        const treeUrl = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${treeSha}?recursive=1`;
        const res = await fetch(treeUrl);
        const data = await res.json();

        if (!data.tree) throw new Error('No tree data');

        if (data.truncated) {
          status.textContent = 'Warning: Collection too large ‚Üí truncated. Split into cats/1/, cats/2/ etc.';
        }

        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –Ω—É–∂–Ω–æ–π –ø–∞–ø–∫–µ
        allFiles = data.tree
          .filter(item => item.type === 'blob' && CONFIG.extensions.test(item.path))
          .filter(item => item.path.startsWith(CONFIG.basePath))
          .map(item => item.path);

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏ (–∏–ª–∏ –ø–æ –¥–∞—Ç–µ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –¥–æ–ø. –∑–∞–ø—Ä–æ—Å, –Ω–æ –¥–æ—Ä–æ–≥–æ)
        allFiles.sort();

        // –ö—ç—à–∏—Ä—É–µ–º
        localStorage.setItem('catsFileList', JSON.stringify(allFiles));
        localStorage.setItem('catsCacheTime', Date.now());

        status.textContent = `Found ${allFiles.length} cats! Rendering...`;
      } catch (err) {
        status.textContent = `Error: ${err.message}. Check username/repo or try later (API limits).`;
        console.error(err);
        allFiles = loadCachedList() || [];
      }
    }

    function renderBatch() {
      const end = Math.min(displayedIndex + BATCH_SIZE, allFiles.length);
      for (let i = displayedIndex; i < end; i++) {
        const path = allFiles[i];
        const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;

        const div = document.createElement('div');
        div.className = 'item';

        const img = document.createElement('img');
        img.src = url;
        img.alt = path.split('/').pop().replace(/\.[^/.]+$/, "");
        img.loading = 'lazy';

        img.onerror = () => { div.remove(); };

        div.appendChild(img);
        gallery.appendChild(div);

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
        setTimeout(() => div.classList.add('visible'), 50 * (i - displayedIndex));
      }

      displayedIndex = end;

      if (displayedIndex >= allFiles.length) {
        loadMoreBtn.disabled = true;
        loadMoreBtn.textContent = 'All cats loaded üê±';
      }

      status.textContent = `Showing ${displayedIndex} of ${allFiles.length}`;
    }

    // Infinite scroll —á–µ—Ä–µ–∑ IntersectionObserver
    const observer = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting && displayedIndex < allFiles.length) {
        renderBatch();
      }
    }, { threshold: 0.1 });

    // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∫–Ω–æ–ø–∫–æ–π –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
    observer.observe(loadMoreBtn);

    // –°—Ç–∞—Ä—Ç
    (async () => {
      allFiles = loadCachedList();
      if (!allFiles || allFiles.length === 0) {
        await fetchFileList();
      } else {
        status.textContent = `Loaded ${allFiles.length} cats from cache!`;
      }

      if (allFiles.length > 0) {
        renderBatch(); // –ø–µ—Ä–≤—ã–π –±–∞—Ç—á
        loadMoreBtn.disabled = false;
      }
    })();

    loadMoreBtn.onclick = renderBatch;
  </script>
</body>
</html>
