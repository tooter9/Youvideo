<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thousands of Cats Gallery</title>
  <style>
    :root { --bg:#000; --text:#ddd; --accent:#ff79c6; --card:#111; }
    body { background:var(--bg); color:var(--text); margin:0; padding:20px; font-family:system-ui,sans-serif; text-align:center; }
    h1 { color:var(--accent); margin:1em 0; }
    #status { color:#888; margin:2em; font-size:1.2em; white-space:pre-wrap; }
    .gallery { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; max-width:1800px; margin:0 auto; }
    .item { background:var(--card); border-radius:10px; overflow:hidden; box-shadow:0 4px 12px #000; transition:0.2s; opacity:0; transform:translateY(30px); }
    .item.visible { opacity:1; transform:translateY(0); }
    .item:hover { transform:scale(1.04); }
    img { width:100%; height:auto; display:block; }
    #loadMore { margin:3em auto; padding:14px 40px; font-size:1.2em; background:var(--accent); color:#000; border:none; border-radius:50px; cursor:pointer; }
    #loadMore:disabled { opacity:0.4; cursor:not-allowed; }
  </style>
</head>
<body>
  <h1>üê± Cats Collection ‚Äì Thousands Forever üêæ</h1>
  <div id="status">Loading thousands of cats... (this may take 10‚Äì60 sec for big collections)</div>

  <div class="gallery" id="gallery"></div>
  <button id="loadMore" disabled>Loading more...</button>

  <script>
    const CONFIG = {
      owner: 'tooter9',                    // ‚Üê —Ç–≤–æ–π –ª–æ–≥–∏–Ω (—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?)
      repo:  'Youvideo',                   // ‚Üê –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Youvideo)
      branch: 'main',                      // –æ–±—ã—á–Ω–æ main –∏–ª–∏ master
      basePaths: ['cats/'],                // –¥–æ–±–∞–≤—å ['cats/', 'cats-extra/'] –µ—Å–ª–∏ —Ä–∞–∑–±–∏–ª –Ω–∞ –ø–æ–¥–ø–∞–ø–∫–∏
      extensions: /\.(jpe?g|png|gif|webp)$/i,
      token: ''                            // ‚Üê –µ—Å–ª–∏ –µ—Å—Ç—å PAT: 'ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' (–Ω–µ –∫–æ–º–º–∏—Ç—å –≤ –ø—É–±–ª–∏—á–Ω—ã–π –∫–æ–¥!)
    };

    let allFiles = [];
    let displayed = 0;
    const BATCH = 60;

    const gallery = document.getElementById('gallery');
    const status = document.getElementById('status');
    const btn = document.getElementById('loadMore');

    function getCache() {
      try {
        const c = localStorage.getItem('catsCache');
        const t = localStorage.getItem('catsCacheTime');
        if (c && Date.now() - t < 7*24*60*60*1000) return JSON.parse(c);
      } catch {}
      return null;
    }

    async function fetchList() {
      status.textContent = 'Fetching file list from GitHub API...';
      const headers = CONFIG.token ? { Authorization: `token ${CONFIG.token}` } : {};
      try {
        const ref = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`, {headers}).then(r=>r.json());
        if (ref.message) throw new Error(ref.message);
        const sha = ref.object.sha;

        const tree = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${sha}?recursive=1`, {headers}).then(r=>r.json());
        if (tree.message) throw new Error(tree.message);

        if (tree.truncated) {
          status.innerHTML = '‚ö†Ô∏è Too many files (truncated by GitHub). Split photos into subfolders:\n‚Ä¢ cats/1/\n‚Ä¢ cats/2/\n etc. (max ~800 per folder)';
        }

        allFiles = [];
        tree.tree.forEach(item => {
          if (item.type === 'blob' && CONFIG.extensions.test(item.path)) {
            for (const bp of CONFIG.basePaths) {
              if (item.path.startsWith(bp)) {
                allFiles.push(item.path);
                break;
              }
            }
          }
        });

        allFiles.sort(); // –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

        localStorage.setItem('catsCache', JSON.stringify(allFiles));
        localStorage.setItem('catsCacheTime', Date.now());

        status.textContent = `Found ${allFiles.length} cat photos! Rendering...`;
      } catch (e) {
        status.textContent = `Error: ${e.message}\n\nPossible fixes:\n1. Check if repo is public\n2. Wait 1 hour (API limit)\n3. Add token in CONFIG.token\n4. Use cache below if available`;
        allFiles = getCache() || [];
        if (allFiles.length) status.innerHTML += `\n\nUsing cached list (${allFiles.length} items)`;
      }
    }

    function renderNextBatch() {
      const end = Math.min(displayed + BATCH, allFiles.length);
      for (let i = displayed; i < end; i++) {
        const path = allFiles[i];
        const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;

        const div = document.createElement('div');
        div.className = 'item';

        const img = new Image();
        img.src = url;
        img.alt = path.split('/').pop().replace(/\.[^/.]+$/, '');
        img.loading = 'lazy';
        img.onerror = () => div.remove();

        div.appendChild(img);
        gallery.appendChild(div);

        setTimeout(() => div.classList.add('visible'), 30 * (i - displayed));
      }
      displayed = end;

      status.textContent = `Showing ${displayed} / ${allFiles.length}`;
      btn.disabled = displayed >= allFiles.length;
      btn.textContent = btn.disabled ? 'All cats loaded üê±' : 'Load more cats';
    }

    const obs = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting && displayed < allFiles.length) renderNextBatch();
    });
    obs.observe(btn);

    (async () => {
      allFiles = getCache();
      if (!allFiles?.length) await fetchList();
      else status.textContent = `Loaded ${allFiles.length} cats from cache (refresh page to update)`;

      if (allFiles.length > 0) {
        renderNextBatch();
        btn.disabled = false;
        btn.textContent = 'Load more cats';
      } else {
        status.innerHTML += '\n\nNo photos found. Upload to /cats/ folder and refresh.';
      }
    })();

    btn.onclick = renderNextBatch;
  </script>
</body>
</html>
