<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat Collection ‚Äì Photos & Videos</title>
  <meta name="description" content="Private gallery of thousands of cats">
  <!-- –ë–∞–∑–æ–≤–∞—è CSP –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–º–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å) -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https://raw.githubusercontent.com; media-src 'self' https://raw.githubusercontent.com; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
  <style>
    :root {
      --bg: #0b0b0f;
      --card: #16161e;
      --text: #d0d0e0;
      --accent: #ff79c6;
      --shadow: 0 6px 20px rgba(0,0,0,0.7);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      min-height: 100vh;
      padding: 1.5rem;
      text-align: center;
    }
    header {
      margin: 2rem 0 3rem;
    }
    h1 {
      color: var(--accent);
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    #status {
      color: #888;
      margin: 2rem 0;
      font-size: 1.2rem;
      white-space: pre-wrap;
    }
    .masonry {
      column-count: 2;
      column-gap: 1rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    @media (min-width: 768px) { .masonry { column-count: 3; } }
    @media (min-width: 1024px) { .masonry { column-count: 4; } }
    .item {
      break-inside: avoid;
      margin-bottom: 1rem;
      border-radius: 12px;
      overflow: hidden;
      background: var(--card);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.4s ease;
    }
    .item.visible {
      opacity: 1;
      transform: translateY(0);
    }
    img, video {
      width: 100%;
      height: auto;
      display: block;
    }
    video {
      background: #000;
    }
    #loadMore {
      margin: 3rem auto 1rem;
      padding: 0.9rem 2.5rem;
      font-size: 1.1rem;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: 0.2s;
    }
    #loadMore:hover:not(:disabled) { transform: scale(1.05); }
    #loadMore:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <header>
    <h1>üê± Cats Gallery ‚Äì Photos & Videos üêæ</h1>
    <p style="color:#777; font-size:1.1rem;">Thousands of moments, forever</p>
  </header>

  <div id="status">Loading your cat universe... (may take 10‚Äì90 sec for large collections)</div>

  <div class="masonry" id="masonry"></div>
  <button id="loadMore" disabled>Load more</button>

  <script>
    const CONFIG = {
      owner: 'tooter9',
      repo:  'Youvideo',
      branch: 'main',           // –ø–æ–º–µ–Ω—è–π –Ω–∞ 'master' –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      basePaths: ['cats/'],     // ['cats/', 'videos/'] –µ—Å–ª–∏ –≤–∏–¥–µ–æ –æ—Ç–¥–µ–ª—å–Ω–æ
      token: ''                 // ‚Üê –≤—Å—Ç–∞–≤—å —Å—é–¥–∞ PAT: 'ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
    };

    let mediaItems = [];
    let shown = 0;
    const BATCH_SIZE = 40; // –º–µ–Ω—å—à–µ –¥–ª—è –≤–∏–¥–µ–æ ‚Äì –ª—É—á—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

    const masonry = document.getElementById('masonry');
    const status = document.getElementById('status');
    const btn = document.getElementById('loadMore');

    function cacheGet() {
      try {
        const data = localStorage.getItem('catMediaCache');
        const time = localStorage.getItem('catMediaTime');
        if (data && Date.now() - time < 7 * 86400000) return JSON.parse(data);
      } catch {}
      return null;
    }

    async function fetchMedia() {
      const headers = CONFIG.token ? { Authorization: `token ${CONFIG.token}` } : {};
      try {
        const refRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/ref/heads/${CONFIG.branch}`, {headers});
        const ref = await refRes.json();
        if (ref.message) throw new Error(ref.message || 'API error');

        const treeRes = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/git/trees/${ref.object.sha}?recursive=1`, {headers});
        const treeData = await treeRes.json();
        if (treeData.message) throw new Error(treeData.message);

        if (treeData.truncated) {
          status.textContent = 'Collection huge ‚Üí truncated. Split folders: cats/1/, cats/2/ etc.';
        }

        mediaItems = treeData.tree
          .filter(f => f.type === 'blob')
          .filter(f => {
            const p = f.path.toLowerCase();
            return CONFIG.basePaths.some(bp => p.startsWith(bp)) &&
                   /\.(jpe?g|png|gif|webp|mp4|webm)$/i.test(p);
          })
          .map(f => ({
            path: f.path,
            isVideo: /\.(mp4|webm)$/i.test(f.path)
          }));

        mediaItems.sort((a,b) => a.path.localeCompare(b.path));

        localStorage.setItem('catMediaCache', JSON.stringify(mediaItems));
        localStorage.setItem('catMediaTime', Date.now());

        status.textContent = `Found ${mediaItems.length} items (photos + videos)!`;
      } catch (err) {
        status.textContent = `Error: ${err.message}\n\nFixes:\n‚Ä¢ Repo public?\n‚Ä¢ Token added?\n‚Ä¢ Branch correct?\n‚Ä¢ Wait API limit (1h)`;
        mediaItems = cacheGet() || [];
        if (mediaItems.length) status.innerHTML += `\n\nCache used: ${mediaItems.length} items`;
      }
    }

    function addBatch() {
      const end = Math.min(shown + BATCH_SIZE, mediaItems.length);
      for (let i = shown; i < end; i++) {
        const item = mediaItems[i];
        const url = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${item.path}`;

        const el = document.createElement('div');
        el.className = 'item';

        if (item.isVideo) {
          const vid = document.createElement('video');
          vid.src = url;
          vid.controls = true;
          vid.preload = 'none';       // lazy –¥–ª—è –≤–∏–¥–µ–æ
          vid.loading = 'lazy';
          vid.playsInline = true;
          vid.muted = true;           // –¥–ª—è –∞–≤—Ç–æ–ø–ª–µ—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
          el.appendChild(vid);
        } else {
          const img = new Image();
          img.src = url;
          img.alt = item.path.split('/').pop().replace(/\.[^/.]+$/, '');
          img.loading = 'lazy';
          img.decoding = 'async';
          img.onerror = () => el.remove();
          el.appendChild(img);
        }

        masonry.appendChild(el);
        setTimeout(() => el.classList.add('visible'), 50 * (i - shown));
      }
      shown = end;

      status.textContent = `Displayed ${shown} / ${mediaItems.length}`;
      btn.disabled = shown >= mediaItems.length;
      btn.textContent = btn.disabled ? 'All loaded üê±üíï' : 'More cats & videos';
    }

    const observer = new IntersectionObserver(ent => {
      if (ent[0].isIntersecting && shown < mediaItems.length) addBatch();
    }, { rootMargin: '400px' });
    observer.observe(btn);

    (async () => {
      mediaItems = cacheGet();
      if (!mediaItems?.length) await fetchMedia();
      else status.textContent = `Cache: ${mediaItems.length} items (refresh to update)`;

      if (mediaItems.length > 0) {
        addBatch();
        btn.disabled = false;
        btn.textContent = 'More cats & videos';
      } else {
        status.innerHTML += '\n\nNo media found in cats/ folder(s). Upload & refresh.';
      }
    })();

    btn.onclick = addBatch;
  </script>
</body>
</html>
